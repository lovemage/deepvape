        // 開啟ibon門市查詢系統 - 使用7-11官方API
        function openIbonStoreMap() {
            // 建構回調URL
            const currentProtocol = window.location.protocol;
            const currentHost = window.location.host;
            
            // 判斷是否為本地開發環境
            const isLocalhost = currentHost.includes('localhost') || currentHost.includes('127.0.0.1');
            
            // 如果是本地開發環境，顯示警告
            if (isLocalhost) {
                alert('⚠️ 注意：您目前在本地開發環境。\n\n7-11門市選擇API需要有效的線上callback URL才能正常運作。\n\n建議將網站部署到線上環境進行測試。');
            }
            
            // 使用簡潔的 API 路徑（避免 .netlify 字樣）
            let callbackUrl;
            if (isLocalhost) {
                // 開發環境：使用實際部署的網址
                callbackUrl = 'https://deepvape.org/api/cvs-callback';
                console.warn('開發環境偵測：使用生產環境 API URL');
            } else {
                // 生產環境：使用當前網址的 API 路徑
                callbackUrl = `${currentProtocol}//${currentHost}/api/cvs-callback`;
            }
            
            // 7-11 電子地圖 API URL
            const eshopId = '870'; // 您的廠商代碼
            const serviceType = '1'; // 服務類型：1=取貨付款
            const apiUrl = `https://emap.presco.com.tw/c2cemap.ashx?eshopid=${eshopId}&servicetype=${serviceType}&url=${encodeURIComponent(callbackUrl)}`;
            
            console.log('開啟7-11電子地圖API:', apiUrl);
            console.log('回調URL:', callbackUrl);
            console.log('環境:', isLocalhost ? '開發環境' : '生產環境');
            
            // 開啟新視窗
            const mapWindow = window.open(apiUrl, 'SevenElevenStoreMap', 'width=1000,height=700,scrollbars=yes,resizable=yes');
            
            if (!mapWindow) {
                alert('無法開啟門市查詢視窗，請檢查瀏覽器的彈出視窗設定。');
                return;
            }
            
            // 顯示使用指引
            alert('📍 7-ELEVEN 門市查詢說明：\n\n' +
                  '1. 在地圖上選擇您要取貨的門市\n' +
                  '2. 點擊「確認」按鈕\n' +
                  '3. 系統將自動回傳門市資訊\n\n' +
                  '⚠️ 注意事項：\n' +
                  '- 請確保允許彈出視窗\n' +
                  '- 選擇門市後系統會自動填入資訊\n' +
                  '- 如果自動填入失敗，您仍可手動輸入門市資訊');
        }
