<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrderManager è¼‰å…¥æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background-color: #d4edda; color: #155724; }
        .warning { background-color: #fff3cd; color: #856404; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ” OrderManager è¼‰å…¥ç‹€æ…‹æ¸¬è©¦</h1>
    
    <div class="test-container">
        <h2>ç³»çµ±ç‹€æ…‹æª¢æŸ¥</h2>
        <div id="systemStatus"></div>
        <button onclick="checkSystemStatus()">é‡æ–°æª¢æŸ¥ç³»çµ±ç‹€æ…‹</button>
    </div>
    
    <div class="test-container">
        <h2>è…³æœ¬è¼‰å…¥æ¸¬è©¦</h2>
        <div id="scriptStatus"></div>
        <button onclick="checkScriptLoading()">æª¢æŸ¥è…³æœ¬è¼‰å…¥</button>
    </div>
    
    <div class="test-container">
        <h2>OrderManager åŠŸèƒ½æ¸¬è©¦</h2>
        <div id="functionStatus"></div>
        <button onclick="testOrderManagerFunctions()">æ¸¬è©¦ OrderManager åŠŸèƒ½</button>
    </div>
    
    <div class="test-container">
        <h2>æ¨¡æ“¬è¨‚å–®å‰µå»ºæ¸¬è©¦</h2>
        <div id="orderTestStatus"></div>
        <button onclick="testOrderCreation()">æ¸¬è©¦è¨‚å–®å‰µå»º</button>
    </div>

    <!-- è¼‰å…¥ç®¡ç†ç³»çµ±è…³æœ¬ -->
    <script src="js/product-manager.js"></script>
    <script src="js/inventory-manager.js"></script>
    <script src="js/order-manager.js"></script>

    <script>
        // æª¢æŸ¥ç³»çµ±ç‹€æ…‹
        function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            let html = '';
            
            // æª¢æŸ¥å„å€‹ç®¡ç†å™¨
            const managers = [
                { name: 'ProductManager', obj: window.ProductManager },
                { name: 'InventoryManager', obj: window.InventoryManager },
                { name: 'OrderManager', obj: window.OrderManager }
            ];
            
            managers.forEach(manager => {
                const exists = !!manager.obj;
                const initialized = manager.obj?.initialized;
                
                html += `<div class="status ${exists ? 'success' : 'error'}">
                    <strong>${manager.name}:</strong> 
                    ${exists ? 'âœ… å·²è¼‰å…¥' : 'âŒ æœªè¼‰å…¥'}
                    ${exists && initialized !== undefined ? 
                        (initialized ? ' (å·²åˆå§‹åŒ–)' : ' (æœªåˆå§‹åŒ–)') : ''}
                </div>`;
            });
            
            statusDiv.innerHTML = html;
        }
        
        // æª¢æŸ¥è…³æœ¬è¼‰å…¥
        function checkScriptLoading() {
            const statusDiv = document.getElementById('scriptStatus');
            let html = '';
            
            // æª¢æŸ¥è…³æœ¬æ–‡ä»¶æ˜¯å¦å­˜åœ¨
            const scripts = [
                'js/product-manager.js',
                'js/inventory-manager.js', 
                'js/order-manager.js'
            ];
            
            html += '<h3>è…³æœ¬è¼‰å…¥ç‹€æ…‹:</h3>';
            
            scripts.forEach(script => {
                const scriptElement = document.querySelector(`script[src="${script}"]`);
                html += `<div class="status ${scriptElement ? 'success' : 'warning'}">
                    <strong>${script}:</strong> 
                    ${scriptElement ? 'âœ… è…³æœ¬æ¨™ç±¤å­˜åœ¨' : 'âš ï¸ è…³æœ¬æ¨™ç±¤ä¸å­˜åœ¨'}
                </div>`;
            });
            
            statusDiv.innerHTML = html;
        }
        
        // æ¸¬è©¦ OrderManager åŠŸèƒ½
        function testOrderManagerFunctions() {
            const statusDiv = document.getElementById('functionStatus');
            let html = '';
            
            if (!window.OrderManager) {
                html = '<div class="status error">âŒ OrderManager æœªè¼‰å…¥</div>';
                statusDiv.innerHTML = html;
                return;
            }
            
            // æª¢æŸ¥é—œéµæ–¹æ³•
            const methods = [
                'init',
                'createOrderFromCart',
                'loadOrders',
                'syncOrderToCMS',
                'generateOrderId'
            ];
            
            html += '<h3>OrderManager æ–¹æ³•æª¢æŸ¥:</h3>';
            
            methods.forEach(method => {
                const exists = typeof window.OrderManager[method] === 'function';
                html += `<div class="status ${exists ? 'success' : 'error'}">
                    <strong>${method}():</strong> 
                    ${exists ? 'âœ… æ–¹æ³•å­˜åœ¨' : 'âŒ æ–¹æ³•ä¸å­˜åœ¨'}
                </div>`;
            });
            
            // æª¢æŸ¥å±¬æ€§
            html += '<h3>OrderManager å±¬æ€§:</h3>';
            html += `<div class="status info">
                <strong>initialized:</strong> ${window.OrderManager.initialized}
            </div>`;
            html += `<div class="status info">
                <strong>orders.length:</strong> ${window.OrderManager.orders?.length || 0}
            </div>`;
            
            statusDiv.innerHTML = html;
        }
        
        // æ¸¬è©¦è¨‚å–®å‰µå»º
        async function testOrderCreation() {
            const statusDiv = document.getElementById('orderTestStatus');
            statusDiv.innerHTML = '<div class="status info">ğŸ”„ æ­£åœ¨æ¸¬è©¦è¨‚å–®å‰µå»º...</div>';
            
            try {
                // æ¨¡æ“¬è³¼ç‰©è»Šæ•¸æ“š
                const testCart = [
                    {
                        id: 'test-product-1',
                        name: 'æ¸¬è©¦ç”¢å“',
                        price: 100,
                        quantity: 1,
                        color: 'é»‘è‰²',
                        image: 'test.jpg'
                    }
                ];
                
                localStorage.setItem('cart', JSON.stringify(testCart));
                
                // æ¨¡æ“¬å®¢æˆ¶ä¿¡æ¯
                const customerInfo = {
                    name: 'æ¸¬è©¦å®¢æˆ¶',
                    phone: '0912345678',
                    email: 'test@example.com'
                };
                
                const shippingInfo = {
                    method: 'convenience_store',
                    address: 'æ¸¬è©¦åœ°å€'
                };
                
                const paymentInfo = {
                    method: 'cash_on_delivery'
                };
                
                let result;
                let html = '';
                
                if (window.OrderManager && typeof window.OrderManager.createOrderFromCart === 'function') {
                    // æ¸¬è©¦ OrderManager
                    html += '<div class="status info">ğŸ“‹ ä½¿ç”¨ OrderManager æ¸¬è©¦...</div>';
                    
                    if (!window.OrderManager.initialized) {
                        await window.OrderManager.init();
                    }
                    
                    result = await window.OrderManager.createOrderFromCart(
                        customerInfo, shippingInfo, paymentInfo
                    );
                    
                    if (result && result.success) {
                        html += '<div class="status success">âœ… OrderManager è¨‚å–®å‰µå»ºæˆåŠŸ</div>';
                        html += `<pre>${JSON.stringify(result.order, null, 2)}</pre>`;
                    } else {
                        html += '<div class="status error">âŒ OrderManager è¨‚å–®å‰µå»ºå¤±æ•—</div>';
                        html += `<div class="status error">éŒ¯èª¤: ${result?.error || 'æœªçŸ¥éŒ¯èª¤'}</div>`;
                    }
                } else {
                    html += '<div class="status warning">âš ï¸ OrderManager ä¸å¯ç”¨ï¼Œç„¡æ³•æ¸¬è©¦</div>';
                }
                
                // æ¸…ç†æ¸¬è©¦æ•¸æ“š
                localStorage.removeItem('cart');
                
                statusDiv.innerHTML = html;
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ æ¸¬è©¦å¤±æ•—: ${error.message}</div>`;
                console.error('æ¸¬è©¦è¨‚å–®å‰µå»ºå¤±æ•—:', error);
            }
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                checkSystemStatus();
                checkScriptLoading();
            }, 1000);
        });
        
        // å®šæœŸæ›´æ–°ç‹€æ…‹
        setInterval(checkSystemStatus, 5000);
    </script>
</body>
</html> 