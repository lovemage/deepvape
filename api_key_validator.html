<!DOCTYPE html>
<html>
<head>
    <title>API金鑰驗證工具</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .test-box { margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
        .info { background: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .code { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; margin: 10px 0; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔑 Google Maps API金鑰驗證工具</h1>
        
        <div class="test-box info">
            <h3>📊 測試進度</h3>
            <div id="progress">準備測試...</div>
        </div>
        
        <div class="test-box">
            <h3>🧪 測試項目</h3>
            <button onclick="testAPIKey()">1. 測試API金鑰格式</button>
            <button onclick="testMapsAPI()">2. 測試Maps API</button>
            <button onclick="testPlacesAPI()">3. 測試Places API</button>
            <button onclick="testGeocodingAPI()">4. 測試Geocoding API</button>
            <button onclick="runAllTests()">🚀 執行所有測試</button>
        </div>
        
        <div id="results"></div>
        
        <div class="test-box">
            <h3>🔧 API金鑰資訊</h3>
            <div class="code">
                <strong>當前API金鑰:</strong> AIzaSyDG6TOXf2AXyGCHvfUWQZD3ZdP6dHd8c2g<br>
                <strong>測試網址:</strong> <span id="currentUrl"></span><br>
                <strong>時間:</strong> <span id="currentTime"></span>
            </div>
        </div>
        
        <div class="test-box warning">
            <h3>⚠️ 常見問題解決</h3>
            <p><strong>如果認證失敗，請檢查:</strong></p>
            <ol>
                <li><strong>API已啟用:</strong> Maps JavaScript API, Places API, Geocoding API</li>
                <li><strong>計費帳戶:</strong> 專案必須連結有效的計費帳戶</li>
                <li><strong>API限制:</strong> 暫時設為"None"進行測試</li>
                <li><strong>配額限制:</strong> 檢查每日使用量是否超限</li>
            </ol>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyDG6TOXf2AXyGCHvfUWQZD3ZdP6dHd8c2g';
        
        // 更新頁面資訊
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('currentTime').textContent = new Date().toLocaleString();
        
        function updateProgress(message) {
            document.getElementById('progress').innerHTML = message;
        }
        
        function addResult(title, status, details) {
            const results = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-box ${status}`;
            resultDiv.innerHTML = `
                <h4>${title}</h4>
                <div>${details}</div>
            `;
            results.appendChild(resultDiv);
        }
        
        function testAPIKey() {
            updateProgress('🔍 檢查API金鑰格式...');
            
            if (!API_KEY) {
                addResult('❌ API金鑰格式檢查', 'error', 'API金鑰為空');
                return;
            }
            
            if (API_KEY.length !== 39) {
                addResult('⚠️ API金鑰格式檢查', 'warning', `API金鑰長度不標準: ${API_KEY.length} (應為39)`);
            } else {
                addResult('✅ API金鑰格式檢查', 'success', 'API金鑰格式正確');
            }
            
            if (!API_KEY.startsWith('AIza')) {
                addResult('⚠️ API金鑰前綴檢查', 'warning', 'API金鑰應以"AIza"開頭');
            } else {
                addResult('✅ API金鑰前綴檢查', 'success', 'API金鑰前綴正確');
            }
        }
        
        async function testMapsAPI() {
            updateProgress('🗺️ 測試Maps JavaScript API...');
            
            try {
                const url = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}`;
                const response = await fetch(url);
                
                if (response.ok) {
                    const text = await response.text();
                    if (text.includes('Google Maps JavaScript API')) {
                        addResult('✅ Maps JavaScript API', 'success', 'API回應正常');
                    } else if (text.includes('REQUEST_DENIED')) {
                        addResult('❌ Maps JavaScript API', 'error', 'API請求被拒絕 - 檢查API金鑰權限');
                    } else if (text.includes('INVALID_REQUEST')) {
                        addResult('❌ Maps JavaScript API', 'error', '無效的API請求');
                    } else {
                        addResult('⚠️ Maps JavaScript API', 'warning', `未知回應: ${text.substring(0, 100)}...`);
                    }
                } else {
                    addResult('❌ Maps JavaScript API', 'error', `HTTP錯誤: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                addResult('❌ Maps JavaScript API', 'error', `網路錯誤: ${error.message}`);
            }
        }
        
        async function testPlacesAPI() {
            updateProgress('🏪 測試Places API...');
            
            try {
                const url = `https://maps.googleapis.com/maps/api/place/textsearch/json?query=7-ELEVEN台北&key=${API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.status === 'OK') {
                    addResult('✅ Places API', 'success', `找到 ${data.results.length} 個結果`);
                } else if (data.status === 'REQUEST_DENIED') {
                    addResult('❌ Places API', 'error', `請求被拒絕: ${data.error_message || '權限不足'}`);
                } else if (data.status === 'OVER_QUERY_LIMIT') {
                    addResult('❌ Places API', 'error', '超過查詢限制 - 檢查配額');
                } else {
                    addResult('⚠️ Places API', 'warning', `狀態: ${data.status}, 訊息: ${data.error_message || '未知錯誤'}`);
                }
            } catch (error) {
                addResult('❌ Places API', 'error', `CORS/網路錯誤: ${error.message}`);
            }
        }
        
        async function testGeocodingAPI() {
            updateProgress('📍 測試Geocoding API...');
            
            try {
                const url = `https://maps.googleapis.com/maps/api/geocode/json?address=台北101&key=${API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.status === 'OK') {
                    addResult('✅ Geocoding API', 'success', `成功轉換地址: ${data.results[0].formatted_address}`);
                } else if (data.status === 'REQUEST_DENIED') {
                    addResult('❌ Geocoding API', 'error', `請求被拒絕: ${data.error_message || '權限不足'}`);
                } else {
                    addResult('⚠️ Geocoding API', 'warning', `狀態: ${data.status}, 訊息: ${data.error_message || '未知錯誤'}`);
                }
            } catch (error) {
                addResult('❌ Geocoding API', 'error', `CORS/網路錯誤: ${error.message}`);
            }
        }
        
        async function runAllTests() {
            document.getElementById('results').innerHTML = '';
            updateProgress('🚀 執行完整測試...');
            
            testAPIKey();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testMapsAPI();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testPlacesAPI();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGeocodingAPI();
            
            updateProgress('✅ 所有測試完成！請查看結果');
        }
        
        // 頁面載入時自動執行基本檢查
        window.addEventListener('load', () => {
            setTimeout(testAPIKey, 1000);
        });
    </script>
</body>
</html> 